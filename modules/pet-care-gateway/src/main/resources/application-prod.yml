server:
  port: 8000
  shutdown: graceful

# 不依赖配置中心
spring:
  application:
    name: pet-care-gateway
  # Redis 配置
  data:
    redis:
      host: ${REDIS_HOST:8.162.13.22}
      port: ${REDIS_PORT:6379}
      password: "!QAZ2wsx"
      database: 0
      timeout: 3000
      lettuce:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 0
  cloud:
    gateway:
      httpclient:
        connect-timeout: 45000
        response-timeout: 300s
      # 全局 CORS 配置
      globalcors:
        cors-configurations:
          '[/**]':
            allowedOriginPatterns: "*"
            allowedMethods:
              - GET
              - POST
              - PUT
              - DELETE
              - OPTIONS
              - PATCH
            allowedHeaders: "*"
            allowCredentials: true
            maxAge: 3600
      routes:
        - id: auth-default-route
          uri: ${CORE_SERVICE_URL:http://localhost:8080}
          predicates:
            - Path=/api/auth/**
          filters:
            - StripPrefix=1
          order: 0
        - id: ws-route
          uri: ${WS_SERVICE_URL:http://localhost:8081}
          predicates:
            - Path=/ws/**
          filters:
            - name: JwtAuth
          order: 0
        - id: core-route
          uri: ${CORE_SERVICE_URL:http://localhost:8080}
          predicates:
            - Path=/api/user/**,/api/pet/**,/api/reminder/**
          filters:
            - StripPrefix=1
            - name: JwtAuth
          order: 0
        - id: ai-sse-route
          uri: ${AI_SSE_SERVICE_URL:http://localhost:8082}
          predicates:
            - Path=/api/ai/chat/**
          filters:
            - StripPrefix=1
            - name: JwtAuth
            - name: Sse
          order: 0
        - id: ai-route
          uri: ${AI_SERVICE_URL:http://localhost:8082}
          predicates:
            - Path=/api/ai/document/**
          filters:
            - StripPrefix=1
            - name: JwtAuth
          order: 0

# JWT配置
jwt:
  enabled: true
  secret-key: ${JWT_SECRET_KEY:"M9Ttt6uwxsaq6PMmFBNQekNWjaFXy+WJSQVQB5IOzdQ="}
  expire-time: ${JWT_EXPIRE_TIME:86400}
  refresh-expire-time: ${JWT_REFRESH_EXPIRE_TIME:604800}

# 暴露网关的 actuator 端点 (用于刷新配置，可选但推荐)
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics

# 日志配置
logging:
  level:
    pvt.mktech.petcare.gateway: INFO
    org.springframework.cloud.gateway: INFO
    reactor.netty.http.client: WARN
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n"
